<!-- build time:Mon Mar 10 2025 11:13:52 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="http://www.ssshyoo.top/rss.xml"><link rel="alternate" type="application/atom+xml" href="http://www.ssshyoo.top/atom.xml"><link rel="alternate" type="application/json" href="http://www.ssshyoo.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://www.ssshyoo.top/2024/08/07/openCV%E5%9B%BE%E7%89%87%E5%92%8C%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/"><title>openCV图片和视频处理 | Aura-HY's Blog =</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">openCV图片和视频处理</h1><div class="meta"><span class="item" title="Created: 2024-08-07 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-08-07T00:00:00+08:00">2024-08-07</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>13k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>11 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Aura-HY's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/🌸天际彩虹千丈_1_安南喜树_来自小红书网页版.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/8k 壁纸分享_7_ᅠᅠᅠ离开那天_来自小红书网页版.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/4k高清电脑壁纸分享～_10_Midjourney 炼金术师_来自小红书网页版.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/hi! guys!! heres my art (_3 💗💗💗_1_插画的珍珠_来自小红书网页版.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/🌸天际彩虹千丈_11_安南喜树_来自小红书网页版.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/4k高清电脑壁纸分享～_1_Midjourney 炼金术师_来自小红书网页版.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://www.ssshyoo.top/2024/08/07/openCV%E5%9B%BE%E7%89%87%E5%92%8C%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Aura-HY"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h1 id="opencvqt"><a class="anchor" href="#opencvqt">#</a> OpenCV+QT</h1><h2 id="文件项目配置"><a class="anchor" href="#文件项目配置">#</a> 文件项目配置</h2><p>属性（相对路径）</p><p>配置调试选择 <code>x64</code></p><p>常规 —— 输出目录 —— <code>..\..\bin</code></p><p>调试 —— 工作目录 —— <code>..\..\bin</code></p><p>C/C++—— 附加包含目录 —— <code>..\include</code></p><p>链接器 —— 常规 —— 附加库目录 —— <code>..\..\lib</code></p><p>链接器 —— 输入 —— 附加依赖项 —— 在前面加 <code>opencv_world331d.dll</code></p><h2 id="开发遇到的坑"><a class="anchor" href="#开发遇到的坑">#</a> 开发遇到的坑</h2><h3 id="ui-文件打不开"><a class="anchor" href="#ui-文件打不开">#</a> ui 文件打不开</h3><p>需要手动右键 <code>ui文件</code> 设置打开方式，选择 <code>qtdesigner.exe</code> ，并设置为默认打开方式</p><h3 id="源文件打不开"><a class="anchor" href="#源文件打不开">#</a> 源文件打不开</h3><p>要考虑是否创建项目的时候漏了一些库没有选择，可以参照 pro 文件和 cmakelist 文件的配置看少配置了什么</p><h2 id="mat"><a class="anchor" href="#mat">#</a> mat</h2><p><code>Mat</code> 是 OpenCV 中的基本图像容器。</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//地址遍历不一定连续的Mat</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; mat.rows; row++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; mat.cols; col++) &#123;</span><br><span class="line">			(&amp;mat.data[row * mat.step])[col * es] = <span class="number">80</span>;<span class="comment">//B</span></span><br><span class="line">			(&amp;mat.data[row * mat.step])[col * es<span class="number">+1</span>] = <span class="number">120</span>;</span><br><span class="line">			(&amp;mat.data[row * mat.step])[col * es<span class="number">+2</span>] = <span class="number">200</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><blockquote><p><code>mat.data</code> 是指向图像数据的指针，类型是 <code>uchar*</code> （无符号字符指针），表示图像的原始像素数据。</p><p><code>mat.step</code> 是每行像素数据在内存中的字节数（步长），它可以比 <code>mat.cols * es</code> 大，特别是在行有对齐要求时。</p><p><code>es</code> 是每个像素的字节数（对于 <code>CV_8UC3</code> 类型， <code>es</code> 是 3，因为每个像素有 3 个通道：B、G 和 R）。</p><p><code>row * mat.step</code> 计算出当前行在图像数据中的起始位置。</p><p><code>col * es</code> 计算出当前列在当前行中的偏移量。</p><p><code>&amp;mat.data[row * mat.step]</code> 得到当前行的起始地址，再加上 <code>col * es</code> 得到当前像素的起始地址。</p></blockquote><h2 id="roi感兴趣区域裁剪图像"><a class="anchor" href="#roi感兴趣区域裁剪图像">#</a> ROI 感兴趣区域裁剪图像</h2><h3 id="cvrect-rect100100300300"><a class="anchor" href="#cvrect-rect100100300300">#</a> <code>cv::Rect rect(100,100,300,300)</code></h3><p>100: 横向位置 100</p><p>100：从上往下 100</p><p>然后在这个点取一个矩形 300*300</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Mat src = <span class="built_in">imread</span>(<span class="string">&quot;1.png&quot;</span>);</span><br><span class="line">	<span class="comment">// 定义一个矩形区域</span></span><br><span class="line">	<span class="function">Rect <span class="title">rect</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line">	Mat roi = <span class="built_in">src</span>(rect);<span class="comment">// 提取该矩形区域作为ROI</span></span><br><span class="line">	MatSize s = roi.size;<span class="comment">// 获取ROI的大小</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个自动调整大小的窗口，其大小与显示的图像相匹配。</span></span><br><span class="line">	<span class="built_in">namedWindow</span>(<span class="string">&quot;roi&quot;</span>,WINDOW_AUTOSIZE);</span><br><span class="line">	<span class="built_in">imshow</span>(<span class="string">&quot;roi&quot;</span>, roi);</span><br><span class="line">	<span class="built_in">namedWindow</span>(<span class="string">&quot;src&quot;</span>);</span><br><span class="line">	<span class="built_in">imshow</span>(<span class="string">&quot;src&quot;</span>, src);</span><br><span class="line">	<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="像素格式和灰度图"><a class="anchor" href="#像素格式和灰度图">#</a> 像素格式和灰度图</h2><h3 id="rgb"><a class="anchor" href="#rgb">#</a> RGB</h3><p>显卡输出的数据是 RGB 形式的，三个字节一个像素</p><h3 id="yuv"><a class="anchor" href="#yuv">#</a> YUV</h3><p>亮度，色度，饱和度，电视，黑白电视，Y 信号就行</p><p>存储空间会比 RGB 小，两个字节一个像素</p><p>压缩算法基于 YUV，更利于做压缩算法，都是转化为 YUV 然后用压缩算法</p><p>图像处理，最终显示的时候要把 YUV 转换为 RGB</p><h3 id="rgay"><a class="anchor" href="#rgay">#</a> RGAY</h3><p>灰度图，一个字节 0~25</p><p>一个字节一个像素 ，高速摄影</p><h3 id="cvtcolorsrcimgcolor_bgr2gray"><a class="anchor" href="#cvtcolorsrcimgcolor_bgr2gray">#</a> <code>cvtColor(src,img,COLOR_BGR2GRAY)</code></h3><p><code>#include&lt;opencv2/imgproc.hpp&gt;</code></p><p>格式转换，BGR 转换为灰度图</p><h3 id="手动实现转换灰度图"><a class="anchor" href="#手动实现转换灰度图">#</a> 手动实现转换灰度图</h3><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//手动实现转换灰度图</span></span><br><span class="line"><span class="comment">//des没有加引用会造成错误</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RGBToGray</span><span class="params">(Mat src, Mat &amp;des)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//GRay = (R*30+G*59+B*11+50)/100</span></span><br><span class="line">	des.<span class="built_in">create</span>(src.rows, src.cols, CV_8UC1);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; src.rows; r++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; src.rows; c++) &#123;</span><br><span class="line">			Vec3b&amp; m = src.<span class="built_in">at</span>&lt;Vec3b&gt;(r, c);</span><br><span class="line">			<span class="type">int</span> gray = (m[<span class="number">2</span>] * <span class="number">30</span> + m[<span class="number">1</span>] * <span class="number">59</span> + m[<span class="number">0</span>] * <span class="number">11</span> + <span class="number">50</span>) / <span class="number">100</span>;</span><br><span class="line">			des.<span class="built_in">at</span>&lt;uchar&gt;(r, c) = gray;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="二值化和阈值"><a class="anchor" href="#二值化和阈值">#</a> 二值化和阈值</h2><h3 id="二值化"><a class="anchor" href="#二值化">#</a> 二值化</h3><p>图片的一种存储方式</p><p>一个黑一个白</p><p>有大概五种算法</p><h3 id="1-thresh_binary二进制阈值化"><a class="anchor" href="#1-thresh_binary二进制阈值化">#</a> 1、 <code>THRESH_BINARY</code> 二进制阈值化</h3><h3 id="2-thresh_binary_inv反二进制阈值化"><a class="anchor" href="#2-thresh_binary_inv反二进制阈值化">#</a> 2、 <code>THRESH_BINARY_INV</code> 反二进制阈值化</h3><p>根据参数，如果满足条件就变成白色，如果不满足就变成黑色，反向处理</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二进制阈值化</span></span><br><span class="line"><span class="comment">//（原图，目标图，阈值，最大值（这里255是白色的意思），方法）</span></span><br><span class="line"><span class="built_in">threshold</span>(gray, bin, <span class="number">100</span>, <span class="number">255</span>,THRESH_BINARY);</span><br><span class="line"></span><br><span class="line"><span class="comment">//反二进制阈值化</span></span><br><span class="line"><span class="built_in">threshold</span>(gray, ibin, <span class="number">100</span>, <span class="number">255</span>, THRESH_BINARY_INV);</span><br></pre></td></tr></table></figure><p></p><h2 id="改变图片的对比度和亮度"><a class="anchor" href="#改变图片的对比度和亮度">#</a> 改变图片的对比度和亮度</h2><h3 id="gij-afij-b"><a class="anchor" href="#gij-afij-b">#</a> <code>g(i,j) = a*f(i,j) + b</code></h3><p>目标像素 = a (对比度) * 原始颜色 + b (亮度)</p><p>a 1.0~3.0 (对比)</p><p>b 0~100 (亮度)</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ChangeGain</span><span class="params">(Mat&amp; src, Mat&amp; des, <span class="type">float</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//`g(i,j) = a*f(i,j) + b`</span></span><br><span class="line">	des.<span class="built_in">create</span>(src.rows, src.cols, src.<span class="built_in">type</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; src.rows; r++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; src.cols; c++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">				des.<span class="built_in">at</span>&lt;Vec3b&gt;(r, c)[i] = <span class="built_in">saturate_cast</span>&lt;uchar&gt;(a * src.<span class="built_in">at</span>&lt;Vec3b&gt;(r, c)[i] + b);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="saturate_castuchar防止溢出"><a class="anchor" href="#saturate_castuchar防止溢出">#</a> <code>saturate_cast&lt;uchar&gt;</code> 防止溢出</h3><p>可能会溢出，超过 255，就不是全白，反射，变成了全黑，不是我们想要的，所以要防止溢出，设置超过 255 它就是 255，全白，R 这个通道超过 255 就是全红，小于 0 就设为 0</p><h3 id="opencv函数convertto"><a class="anchor" href="#opencv函数convertto">#</a> opencv 函数 <code>convertTo()</code></h3><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main()</span></span><br><span class="line"><span class="comment">//调整对比度和亮度</span></span><br><span class="line">Mat src = <span class="built_in">imread</span>(<span class="string">&quot;1.png&quot;</span>);</span><br><span class="line">Mat des;</span><br><span class="line"><span class="built_in">PrintMs</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="built_in">ChangeGain</span>(src, des, <span class="number">2.0</span>, <span class="number">50</span>);</span><br><span class="line"><span class="built_in">PrintMs</span>(<span class="string">&quot;ChangeGain&quot;</span>);</span><br><span class="line">Mat des2;</span><br><span class="line"><span class="comment">//使用opencv的函数，测试体现convertTo更快</span></span><br><span class="line"><span class="comment">//-1表示与原图src一致</span></span><br><span class="line">src.<span class="built_in">convertTo</span>(des2, <span class="number">-1</span>, <span class="number">2.0</span>, <span class="number">50</span>);</span><br><span class="line"><span class="built_in">PrintMs</span>(<span class="string">&quot;convertTo&quot;</span>);</span><br></pre></td></tr></table></figure><p></p><h2 id="图像尺寸调整"><a class="anchor" href="#图像尺寸调整">#</a> 图像尺寸调整</h2><h3 id="inter_nearest邻近算法"><a class="anchor" href="#inter_nearest邻近算法">#</a> <code>INTER_NEAREST</code> 邻近算法</h3><p>小变大 —— 拷贝周围的像素，会生成马赛克</p><h4 id="自定义"><a class="anchor" href="#自定义">#</a> 自定义</h4><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sx,sy = <span class="number">0</span>;<span class="comment">//原图对应的坐标</span></span><br><span class="line"><span class="type">float</span> fy = <span class="built_in">float</span>(src.rows)/out.rows;</span><br><span class="line"><span class="type">float</span> fx = <span class="built_in">float</span>(src.cols)/out.cols;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">0</span>;y &lt; out.rows;y++ )&#123;</span><br><span class="line">    sy = fy * y + <span class="number">0.5</span>;<span class="comment">//四舍五入</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">0</span>;x &lt; out.cols;x++)&#123;</span><br><span class="line">        sx = fx * x <span class="number">+0.5</span>;</span><br><span class="line">        out.<span class="built_in">at</span>&lt;Vec3b&gt;(x,y) = src.<span class="built_in">at</span>&lt;Vec3b&gt;(sy,sx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义缩放代码</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xresize</span><span class="params">(Mat&amp; src, Mat&amp; des, Size size)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//type()指的是这个类型是RGB还是灰度图</span></span><br><span class="line">	des.<span class="built_in">create</span>(size, src.<span class="built_in">type</span>());</span><br><span class="line">	<span class="type">int</span> sx, sy = <span class="number">0</span>;<span class="comment">//原图对应的坐标</span></span><br><span class="line">	<span class="type">float</span> fy = <span class="built_in">float</span>(src.rows) / des.rows;</span><br><span class="line">	<span class="type">float</span> fx = <span class="built_in">float</span>(src.cols) / des.cols;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; des.rows; y++) &#123;</span><br><span class="line">		sy = fy * y + <span class="number">0.5</span>;<span class="comment">//四舍五入</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; des.cols; x++) &#123;</span><br><span class="line">			sx = fx * x + <span class="number">0.5</span>;</span><br><span class="line">			des.<span class="built_in">at</span>&lt;Vec3b&gt;(x, y) = src.<span class="built_in">at</span>&lt;Vec3b&gt;(sy, sx);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main()</span></span><br><span class="line">Mat src = <span class="built_in">imread</span>(<span class="string">&quot;1.png&quot;</span>); </span><br><span class="line">Mat img128;</span><br><span class="line"><span class="comment">//原图，目标图，放缩尺寸</span></span><br><span class="line"><span class="built_in">xresize</span>(src, img128, <span class="built_in">Size</span>(<span class="number">128</span>, <span class="number">128</span>));</span><br></pre></td></tr></table></figure><p></p><h4 id="opencv的-resize"><a class="anchor" href="#opencv的-resize">#</a> OpenCV 的 <code>resize()</code></h4><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//opencv自带的函数，有多线程处理、优化</span></span><br><span class="line"><span class="built_in">resize</span>(src, img256, <span class="built_in">Size</span>(<span class="number">256</span>, <span class="number">256</span>),<span class="number">0</span>,<span class="number">0</span>，INTER_NEAREST);</span><br></pre></td></tr></table></figure><p></p><p>第 4、5 个参数表示 fx,fy, 当 Size 为空时，它们作为一个比例来乘以原图的大小</p><p>第 6 个参数，算法类型，默认是双线性插值，这里是邻近算法</p><h3 id="cv_inter_linear-双线性插值缺省使用"><a class="anchor" href="#cv_inter_linear-双线性插值缺省使用">#</a> <code>CV_INTER_LINEAR</code> 双线性插值（缺省使用）</h3><h4 id="滤波"><a class="anchor" href="#滤波">#</a> 滤波</h4><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806120841036.png" alt="image-20240806120841036"></p><p>解决放大图像边界会出现马赛克、模糊的情况</p><h4 id="双线性内插值"><a class="anchor" href="#双线性内插值">#</a> 双线性内插值</h4><p>使放大的图像边界更加平滑</p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806121855326.png" alt="image-20240806121855326"></p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806122849235.png" alt="image-20240806122849235"></p><p>使用：直接把方法参数处改为 <code>INTER_LINEAR</code></p><h2 id="图像金字塔"><a class="anchor" href="#图像金字塔">#</a> 图像金字塔</h2><p>在图像放大缩小、拼接、扭曲都可以用到这种算法</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//高斯金字塔，原图，目标图</span></span><br><span class="line"><span class="built_in">pyrDown</span>(src, gsrc);</span><br><span class="line"></span><br><span class="line"><span class="comment">//拉普拉斯金字塔</span></span><br><span class="line"><span class="built_in">pyrUp</span>(src, lsrc);</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806123833136.png" alt="image-20240806123833136"></p><h3 id="高斯金字塔向下采样缩小"><a class="anchor" href="#高斯金字塔向下采样缩小">#</a> 高斯金字塔（向下采样缩小）</h3><p>用来向下采样</p><p>把整个分辨率降低</p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806123851349.png" alt="image-20240806123851349"></p><p>比如图像是 8*8 的，卷积后将所有偶数行和列去除，就缩小成了 4*4 的图像</p><p>G (i+1) 表示上一层</p><h4 id="高斯内核"><a class="anchor" href="#高斯内核">#</a> 高斯内核</h4><p>提供好的固定的矩阵</p><p>opencv 提供的高斯金字塔只支持这种 5*5 的矩阵</p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806205111854.png" alt="image-20240806205111854"></p><h3 id="拉普拉斯金字塔"><a class="anchor" href="#拉普拉斯金字塔">#</a> 拉普拉斯金字塔</h3><p>用来从金字塔低层图像重建上层未采样图像</p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806205436330.png" alt="image-20240806205436330"></p><h2 id="两幅图像混合blending"><a class="anchor" href="#两幅图像混合blending">#</a> 两幅图像混合（blending）</h2><h3 id="公式"><a class="anchor" href="#公式">#</a> 公式</h3><p><strong><code>dst = src1*a + src2*(1-a) + gamma</code></strong></p><p>最终叠化成果的像素集 = 原图 1 * 透明度 + 原图 2 * 透明度</p><p><code>（1-透明度）</code> 是为了融合度高，一个高一个低</p><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806223204829.png" alt="image-20240806223204829"></p><h3 id="opencv-addweighted"><a class="anchor" href="#opencv-addweighted">#</a> OpenCV- <code>addWeighted()</code></h3><p>第五个参数（0.0）：对图像的增益，比如颜色更深，白色更亮</p><p>第六个参数（dst)：最终生成的目标</p><h2 id="图像旋转和镜像"><a class="anchor" href="#图像旋转和镜像">#</a> 图像旋转和镜像</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//旋转rotate</span></span><br><span class="line">Mat rot;</span><br><span class="line">cv::<span class="built_in">rotate</span>(src, rot, ROTATE_90_CLOCKWISE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//镜像flip</span></span><br><span class="line">Mat fl;</span><br><span class="line">cv::<span class="built_in">flip</span>(src, fl, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p></p><h3 id="旋转"><a class="anchor" href="#旋转">#</a> 旋转</h3><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806224542424.png" alt="image-20240806224542424"></p><h3 id="镜像"><a class="anchor" href="#镜像">#</a> 镜像</h3><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240806224619312.png" alt="image-20240806224619312"></p><p>0 (x)—— 上下做镜像</p><p>1 (y)—— 左右做镜像</p><p>-1—— 两个都做</p><h2 id="通过roi图像合并"><a class="anchor" href="#通过roi图像合并">#</a> 通过 ROI 图像合并</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//roi图像合并</span></span><br><span class="line"><span class="comment">//使图像高度一致</span></span><br><span class="line">    <span class="type">int</span> height = src.rows;</span><br><span class="line">    <span class="type">int</span> width1 = src.cols;</span><br><span class="line">    <span class="type">int</span> width2 = src<span class="number">2.</span>cols;</span><br><span class="line"><span class="comment">//将高图像等比缩放</span></span><br><span class="line">    <span class="keyword">if</span> (src.rows &gt; src<span class="number">2.</span>rows) &#123;</span><br><span class="line">        height = src<span class="number">2.</span>rows;</span><br><span class="line">        width1 = src.cols * ((<span class="type">float</span>)src<span class="number">2.</span>rows / (<span class="type">float</span>)src.rows);</span><br><span class="line">        <span class="built_in">resize</span>(src, src, <span class="built_in">Size</span>(width1, height));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (src.rows &lt; src<span class="number">2.</span>rows) &#123;</span><br><span class="line">        width2 = src<span class="number">2.</span>cols * ((<span class="type">float</span>)src.rows / (<span class="type">float</span>)src<span class="number">2.</span>rows);</span><br><span class="line">        <span class="built_in">resize</span>(src2, src2, <span class="built_in">Size</span>(width2, height));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//创建目标Mat</span></span><br><span class="line">    Mat des;</span><br><span class="line">    des.<span class="built_in">create</span>(height, width1 + width2, src.<span class="built_in">type</span>());</span><br><span class="line">    Mat r1 = <span class="built_in">des</span>(<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, width1, height));</span><br><span class="line">    Mat r2 = <span class="built_in">des</span>(<span class="built_in">Rect</span>(width1, <span class="number">0</span>, width2, height));</span><br><span class="line">    src.<span class="built_in">copyTo</span>(r1);</span><br><span class="line">    src<span class="number">2.</span><span class="built_in">copyTo</span>(r2);</span><br></pre></td></tr></table></figure><p></p><h2 id="ffmpeg工具抽取剪切音频合并视频"><a class="anchor" href="#ffmpeg工具抽取剪切音频合并视频">#</a> ffmpeg 工具抽取剪切音频合并视频</h2><h3 id="抽取音频"><a class="anchor" href="#抽取音频">#</a> 抽取音频</h3><p><code>ffmpeg.exe -i 1.avi -vn 1.mp3</code></p><p>-i 表示源 1.avi 输入文件 -vn 表示不转换视频 1.MP3 输出文件</p><h3 id="剪切音频"><a class="anchor" href="#剪切音频">#</a> 剪切音频</h3><p><code>ffmpeg -ss 0:0:30 -t 0:0:20 -i input.mp3 -c copy output.mp3</code></p><p>-ss 表示开始时间 -t 表示剪切时间</p><h3 id="音视频合并"><a class="anchor" href="#音视频合并">#</a> 音视频合并</h3><p><code>ffmpeg.exe -i 1.mp3 -i 1.mp4 -c copy out.mp4</code></p><h2 id="opencv-videocapture读取视频"><a class="anchor" href="#opencv-videocapture读取视频">#</a> OpenCV VideoCapture 读取视频</h2><h3 id="videocapture类"><a class="anchor" href="#videocapture类">#</a> VideoCapture 类</h3><p>这是一个读取视频的类，视频源可以是文件、摄像头、RTSP 流都可以</p><h3 id="打开摄像头方式"><a class="anchor" href="#打开摄像头方式">#</a> 打开摄像头方式</h3><h4 id="bool-openint-index"><a class="anchor" href="#bool-openint-index">#</a> <code>bool open(int index)</code></h4><p>这个参数 index 索引对应你的所有摄像机列表</p><h5 id="openint-cameranumint-apipreference"><a class="anchor" href="#openint-cameranumint-apipreference">#</a> <code>open(int cameraNum.int apiPreference)</code></h5><p>可以手动选择 api 接口，默认是 0 ，自动监测</p><h4 id="videocapture-capindex"><a class="anchor" href="#videocapture-capindex">#</a> <code>VideoCapture cap(index)</code></h4><p>这是一个构造函数</p><h3 id="打开视频流文件"><a class="anchor" href="#打开视频流文件">#</a> 打开视频流文件</h3><h4 id="bool-openconst-string-filename"><a class="anchor" href="#bool-openconst-string-filename">#</a> <code>bool open(const String &amp;filename)</code></h4><h4 id="videocapture-capconst-string-file"><a class="anchor" href="#videocapture-capconst-string-file">#</a> <code>VideoCapture cap(const String&amp; file)</code></h4><h4 id="bool-openconst-string-filenameint-apipreference"><a class="anchor" href="#bool-openconst-string-filenameint-apipreference">#</a> <code>bool open(const String &amp;filename,int apiPreference)</code></h4><h3 id="关闭和空间释放"><a class="anchor" href="#关闭和空间释放">#</a> 关闭和空间释放</h3><h4 id="~videocapture"><a class="anchor" href="#~videocapture">#</a> <code>~VideoCapture()</code></h4><p>析构函数，智能指针，在复制之后，引用计数会加一，直到没有引用，才会释放，通过智能指针，空间的释放不用做太多的管理</p><p>如果不想要转码的时候调用全部 gpu，可以修改源码</p><h4 id="release"><a class="anchor" href="#release">#</a> <code>release()</code></h4><p>主动释放，如果 VideoCapture 被两次调用，一个引用 - 1，另一个空间也不会被释放掉，只是把你这次的引用 - 1</p><h2 id="读取一帧视频"><a class="anchor" href="#读取一帧视频">#</a> 读取一帧视频</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">VideoCapture video;</span><br><span class="line">video.<span class="built_in">open</span>(<span class="string">&quot;1.mp4&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!video.<span class="built_in">isOpened</span>()) &#123;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;success&quot;</span>;</span><br><span class="line">Mat frame;<span class="comment">//用于存储每一帧视频图像</span></span><br><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从视频中读取一帧并存储在 frame 中。如果读取失败，退出循环。</span></span><br><span class="line">	<span class="comment">/*if (!video.read(frame)) &#123;</span></span><br><span class="line"><span class="comment">		break;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//读帧，解码</span></span><br><span class="line">	<span class="keyword">if</span> (!video.<span class="built_in">grab</span>()) &#123;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//转换颜色格式</span></span><br><span class="line">	<span class="keyword">if</span> (!video.<span class="built_in">retrieve</span>(frame)) &#123;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">if</span> (frame.<span class="built_in">empty</span>()) <span class="keyword">break</span>;</span><br><span class="line">	<span class="comment">//显示当前帧。</span></span><br><span class="line">	<span class="built_in">imshow</span>(<span class="string">&quot;video&quot;</span>, frame);</span><br><span class="line">	<span class="comment">//等待5毫秒,与播放出来的速度有关</span></span><br><span class="line">	<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="readoutputarray-image"><a class="anchor" href="#readoutputarray-image">#</a> <code>read(OutputArray image)</code></h3><p>它先是解压缩（解码），然后对图片做了色彩转换</p><p>h264 用一帧画面存储整个，也是用 jpg 来压缩，后面 50 帧画面只存储与这一帧的<strong>变化</strong>，这样的压缩率非常高，这样的话就存在一个问题，每一帧必须都要解码，比如说第十帧是针对第九帧的变化，那么取出一整个画面就是不对的，所以我们可以<strong>先把前面的解码</strong>，先不做图像转换，不显示，以提高效率</p><h3 id="bool-grab"><a class="anchor" href="#bool-grab">#</a> <code>bool grab()</code></h3><p>读取并解码</p><h3 id="virtual-bool-retrieveoutputarray-imageint-flag-0"><a class="anchor" href="#virtual-bool-retrieveoutputarray-imageint-flag-0">#</a> <code>virtual bool retrieve(OutputArray image,int flag = 0 )</code></h3><p>图像色彩转换</p><h3 id="vcmat"><a class="anchor" href="#vcmat">#</a> <code>vc&gt;&gt;mat</code></h3><h2 id="获取视频-相机属性"><a class="anchor" href="#获取视频-相机属性">#</a> 获取视频、相机属性</h2><p>其他属性的获取可以看 OpenCV 的 api 文档 ——OpenCV Flags for video I/O</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fps = video.<span class="built_in">get</span>(CAP_PROP_FPS);<span class="comment">//帧率，使用get()，里面放以下的参数</span></span><br><span class="line"><span class="type">int</span> s = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">if</span> (fps != <span class="number">0</span>) s = <span class="number">1000</span> / fps;<span class="comment">//帧数</span></span><br></pre></td></tr></table></figure><p></p><h3 id="cap_prop_fps-帧率"><a class="anchor" href="#cap_prop_fps-帧率">#</a> <code>CAP_PROP_FPS</code> 帧率</h3><p>一秒钟的帧数</p><h3 id="cap_prop_frame_count总帧数"><a class="anchor" href="#cap_prop_frame_count总帧数">#</a> <code>CAP_PROP_FRAME_COUNT</code> 总帧数</h3><p>计算视频时长：总帧数除以帧率（s）</p><h3 id="cap_prop_pos_frames播放帧的位置"><a class="anchor" href="#cap_prop_pos_frames播放帧的位置">#</a> <code>CAP_PROP_POS_FRAMES</code> 播放帧的位置</h3><p>跳帧，下一帧</p><h3 id="cap_prop_frame_width-height"><a class="anchor" href="#cap_prop_frame_width-height">#</a> <code>CAP_PROP_FRAME_WIDTH HEIGHT</code></h3><p>可以获取到视频帧的宽度高度，虽然一解码的时候可以获取到这个信息，但是有些处理，还没有读帧的时候需要用到这个高度，就需要用到，比如窗口自适应</p><h2 id="设置视频播放的进度"><a class="anchor" href="#设置视频播放的进度">#</a> 设置视频播放的进度</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cur = video.<span class="built_in">get</span>(CAP_PROP_POS_FRAMES);</span><br><span class="line"><span class="comment">//视频经过3s跳到开头</span></span><br><span class="line"><span class="keyword">if</span> (cur &gt; <span class="number">90</span>) &#123;</span><br><span class="line">	video.<span class="built_in">set</span>(CAP_PROP_POS_FRAMES, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="cap_prop_pos_msec毫秒位置"><a class="anchor" href="#cap_prop_pos_msec毫秒位置">#</a> <code>CAP_PROP_POS_MSEC</code> 毫秒位置</h3><p>毫秒 -&gt; 帧 -&gt;ffmpeg 时间，要转两次，浮点数值来回转换，会出现数据的丢失，所以建议使用帧位置</p><h3 id="cap_prop_pos_frames帧位置"><a class="anchor" href="#cap_prop_pos_frames帧位置">#</a> <code>CAP_PROP_POS_FRAMES</code> 帧位置</h3><h2 id="videowriter"><a class="anchor" href="#videowriter">#</a> VideoWriter</h2><p><img data-src="https://cdn.jsdelivr.net/gh/Aura-HY/blogImage@main/img/image-20240807123150031.png" alt="image-20240807123150031"></p><p>要主动释放 release ()</p><h3 id="void-writeconst-mat"><a class="anchor" href="#void-writeconst-mat">#</a> <code>void write(const Mat&amp;)</code></h3><h3 id="cvvideowriter_ffmpegwriteframe"><a class="anchor" href="#cvvideowriter_ffmpegwriteframe">#</a> <code>CvVideoWriter_FFMPEG::writeFrame</code></h3><h2 id="录制摄像头视频并存储代码"><a class="anchor" href="#录制摄像头视频并存储代码">#</a> 录制摄像头视频并存储代码</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//参数 0 指定使用第一个连接的摄像头</span></span><br><span class="line">	<span class="function">VideoCapture <span class="title">cam</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//检查摄像头是否成功打开</span></span><br><span class="line">	<span class="keyword">if</span> (!cam.<span class="built_in">isOpened</span>()) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;success&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用于存储图像帧</span></span><br><span class="line">	Mat img;</span><br><span class="line">	<span class="comment">//用于写入视频文件</span></span><br><span class="line">	VideoWriter vw;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取摄像头的帧率（fps）</span></span><br><span class="line">	<span class="type">int</span> fps = cam.<span class="built_in">get</span>(CAP_PROP_FPS);</span><br><span class="line">	<span class="comment">//如果获取失败或帧率小于等于0，则默认设置帧率为25。</span></span><br><span class="line">	<span class="keyword">if</span> (fps &lt;= <span class="number">0</span>) fps = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打开视频写入器 vw 并准备写入文件 &quot;out.avi&quot;。</span></span><br><span class="line">	vw.<span class="built_in">open</span>(<span class="string">&quot;out.avi&quot;</span>,</span><br><span class="line">		VideoWriter::<span class="built_in">fourcc</span>(<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>),<span class="comment">//指定视频编码格式为X264。</span></span><br><span class="line">		fps,<span class="comment">//每秒帧数</span></span><br><span class="line">		<span class="built_in">Size</span>(cam.<span class="built_in">get</span>(CAP_PROP_FRAME_WIDTH),<span class="comment">//指定视频的宽度和高度</span></span><br><span class="line">			cam.<span class="built_in">get</span>(CAP_PROP_FRAME_HEIGHT))</span><br><span class="line">		<span class="comment">//两个函数返回摄像头当前设置的帧宽度和高度，单位是像素</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//检查视频写入器是否成功打开</span></span><br><span class="line">	<span class="keyword">if</span> (!vw.<span class="built_in">isOpened</span>()) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;falied&quot;</span> &lt;&lt; endl;</span><br><span class="line">		<span class="built_in">getchar</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;vw success&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">namedWindow</span>(<span class="string">&quot;cam&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		<span class="comment">//读取摄像头的一帧图像到 img</span></span><br><span class="line">		cam.<span class="built_in">read</span>(img);</span><br><span class="line">		<span class="keyword">if</span> (img.<span class="built_in">empty</span>()) <span class="keyword">break</span>;</span><br><span class="line">		<span class="built_in">imshow</span>(<span class="string">&quot;cam&quot;</span>, img);</span><br><span class="line">		<span class="comment">//将图像 img 写入视频文件</span></span><br><span class="line">		vw.<span class="built_in">write</span>(img);</span><br><span class="line">		<span class="comment">//q退出</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">waitKey</span>(<span class="number">5</span>) == <span class="string">&#x27;q&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="视频编辑器"><a class="anchor" href="#视频编辑器">#</a> 视频编辑器</h2><h3 id="bug修复"><a class="anchor" href="#bug修复">#</a> bug 修复</h3><p>1、信号没有发送</p><p>线程没有开启，要在线程中加入 <code>start()</code></p><p>2、在头文件中的函数要在 cpp 中有</p><h3 id="流程"><a class="anchor" href="#流程">#</a> 流程</h3><h4 id="前期"><a class="anchor" href="#前期">#</a> 前期</h4><ul><li>设置页面背景色</li><li>取消顶部菜单栏 <code>setWindowFlags(Qt::FramelessWindowHint);</code></li><li>添加关闭按钮，设置信号与槽</li></ul><h4 id="视频显示"><a class="anchor" href="#视频显示">#</a> 视频显示</h4><ul><li>ui 添加 glWidget，并提升为新建立的类</li><li>在主.cpp 中添加上传文件按钮，并设置 open 函数，连接信号槽</li></ul><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">VideoUI::open</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//返回的是一个路径</span></span><br><span class="line">   QString name = QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,QString::<span class="built_in">fromLocal8Bit</span>( <span class="string">&quot;请选择要编辑的视频/图片&quot;</span>));</span><br><span class="line">   <span class="keyword">if</span> (name.<span class="built_in">isEmpty</span>()) <span class="keyword">return</span>;</span><br><span class="line">   <span class="comment">//主要是防止中文文件报错</span></span><br><span class="line">   string file = name.<span class="built_in">toLocal8Bit</span>().<span class="built_in">data</span>();</span><br><span class="line">   <span class="comment">//QMessageBox::information(this, QString::fromLocal8Bit(&quot;获取视频名消息&quot;), name);</span></span><br><span class="line">   <span class="comment">//在线程中创建对象，打开文件</span></span><br><span class="line">    <span class="keyword">if</span> (!videoThread::<span class="built_in">Get</span>()-&gt;<span class="built_in">open</span>(file)) &#123;</span><br><span class="line">       QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="string">&quot;&quot;</span>,name+<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><ul><li>创建线程，开启线程，在线程中打开文件，在 VideoUI 的 open 函数中调用 videoThread 类中的 get 创建对象，执行 open 函数</li></ul><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用于打开视频文件或摄像头，并从中读取视频帧</span></span><br><span class="line"><span class="type">static</span> VideoCapture cap1;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">videoThread::open</span><span class="params">(<span class="type">const</span> std::string file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mutex.<span class="built_in">lock</span>();</span><br><span class="line">	<span class="type">bool</span> re = cap<span class="number">1.</span><span class="built_in">open</span>(file);</span><br><span class="line">	mutex.<span class="built_in">unlock</span>();</span><br><span class="line">	cout &lt;&lt; re &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><ul><li>线程启动后会自动调用 run (), 读取每帧视频存到 mat 对象中</li><li>传递信号至 ui 中的显示容器中，用 setImage1 () 处理图像，paintEvent () 刷新图像</li></ul><h4 id="视频进度条"><a class="anchor" href="#视频进度条">#</a> 视频进度条</h4><h5 id="设置进度条随视频变化"><a class="anchor" href="#设置进度条随视频变化">#</a> 设置进度条随视频变化：</h5><p>在 VideoUI 中设置定时器，定时器获取到当前视频的播放状态然后再改变滑动条的位置</p><p>videoThread 返回播放进度或者返回成员也能算出进度</p><h5 id="拖动进度条变化视频"><a class="anchor" href="#拖动进度条变化视频">#</a> 拖动进度条变化视频：</h5><ul><li>拖动进度条发送信号，带有参数，传进槽函数中处理</li><li>在槽函数中将参数传入线程中调用 seek 函数，seek 函数获取当前视频的总帧数，计算出当前的位置</li><li>传到另一个 seek 中设置画面到算出的这个位置</li></ul><h4 id="视频亮度和对比度调整"><a class="anchor" href="#视频亮度和对比度调整">#</a> 视频亮度和对比度调整</h4><p>videoUI-&gt;Filter-&gt;imagePro</p><h5 id="添加videofilter类"><a class="anchor" href="#添加videofilter类">#</a> 添加 videoFilter 类</h5><p>相当于一个任务列表，执行多个任务，把任务依次给 imagePro 来执行，所以要先搞 imagePro</p><h5 id="接收界面设置的参数"><a class="anchor" href="#接收界面设置的参数">#</a> 接收界面设置的参数</h5><h5 id="输出处理后的视频"><a class="anchor" href="#输出处理后的视频">#</a> 输出处理后的视频</h5><h4 id="后续每添加一个功能"><a class="anchor" href="#后续每添加一个功能">#</a> 后续每添加一个功能</h4><p>先做函数，再加过滤器（任务），调用对应处理的函数，然后就是 ui 部分</p><h3 id="videothreadh"><a class="anchor" href="#videothreadh">#</a> videoThread.h</h3><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">videoThread</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//这是一个静态成员函数声明。</span></span><br><span class="line">    <span class="comment">//static 意味着这个函数属于整个类，而不是属于某个对象（实例）。			</span></span><br><span class="line">    <span class="comment">//videoThread* 是返回类型，表示这个函数返回的是一个 videoThread 类型的指针。</span></span><br><span class="line">    <span class="comment">//可以在没有创建对象的情况下调用它。</span></span><br><span class="line">	<span class="function"><span class="type">static</span> videoThread* <span class="title">Get</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">static</span> videoThread vt;</span><br><span class="line">		<span class="keyword">return</span> &amp;vt;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打开一号视频源文件</span></span><br><span class="line">    <span class="comment">//const 表示这个输入字符串在函数内不能被修改。</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">open</span><span class="params">(<span class="type">const</span> std::string file)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是一个清理对象时自动调用的函数。</span></span><br><span class="line">	~<span class="built_in">videoThread</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//线程入口函数</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将以下内容隐藏起来，只允许类本身或其子类访问。</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">//构造函数在创建类的对象时自动调用。</span></span><br><span class="line">	<span class="built_in">videoThread</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h3 id="videothreadhpp"><a class="anchor" href="#videothreadhpp">#</a> videoThread.hpp</h3><h4 id="mutex-互斥锁"><a class="anchor" href="#mutex-互斥锁">#</a> mutex 互斥锁</h4><p>用来防止多个线程同时访问 <code>cap1</code> 对象，避免数据竞争，在执行 “任务” 的时候上锁，防止别的线程插队，等执行完后再解锁，这个上锁解锁的原则就是晚锁早解，提高效率</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;videoThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;qdebug.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用于打开视频文件或摄像头，并从中读取视频帧</span></span><br><span class="line"><span class="type">static</span> VideoCapture cap1;</span><br><span class="line"><span class="comment">//检查线程是否退出</span></span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> isexit = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">videoThread::<span class="built_in">videoThread</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//要开启线程，否则其他都不会执行</span></span><br><span class="line">	<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">videoThread::open</span><span class="params">(<span class="type">const</span> std::string file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mutex.<span class="built_in">lock</span>();</span><br><span class="line">    <span class="comment">//打开视频文件</span></span><br><span class="line">	<span class="type">bool</span> re = cap<span class="number">1.</span><span class="built_in">open</span>(file);</span><br><span class="line">	mutex.<span class="built_in">unlock</span>();</span><br><span class="line">	cout &lt;&lt; re &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">videoThread::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">	Mat m;</span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		mutex.<span class="built_in">lock</span>();</span><br><span class="line">        <span class="comment">//如果isexit被设置为true（表示线程需要退出），则退出循环，并终止线程</span></span><br><span class="line">		<span class="keyword">if</span> (isexit) &#123;</span><br><span class="line">			mutex.<span class="built_in">unlock</span>();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//判断视频是否打开</span></span><br><span class="line">		<span class="keyword">if</span> (!cap<span class="number">1.</span><span class="built_in">isOpened</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			mutex.<span class="built_in">unlock</span>();</span><br><span class="line">			<span class="built_in">msleep</span>(<span class="number">5</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//读取视频</span></span><br><span class="line">		<span class="keyword">if</span> (!cap<span class="number">1.</span><span class="built_in">read</span>(m) || m.<span class="built_in">empty</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			mutex.<span class="built_in">unlock</span>();</span><br><span class="line">			<span class="built_in">msleep</span>(<span class="number">5</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//显示图像,发送信号</span></span><br><span class="line">		<span class="function">emit <span class="title">viewImage1</span><span class="params">(m)</span></span>;</span><br><span class="line">		<span class="built_in">msleep</span>(<span class="number">40</span>);</span><br><span class="line">		mutex.<span class="built_in">unlock</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">videoThread::~<span class="built_in">videoThread</span>()</span><br><span class="line">&#123;</span><br><span class="line">	mutex.<span class="built_in">lock</span>();</span><br><span class="line">	isexit = <span class="literal">true</span>;</span><br><span class="line">	mutex.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="videowidgethpp"><a class="anchor" href="#videowidgethpp">#</a> videoWidget.hpp</h3><h4 id="void-videowidgetpainteventqpaintevent-e"><a class="anchor" href="#void-videowidgetpainteventqpaintevent-e">#</a> <code>void videoWidget::paintEvent(QPaintEvent* e)</code></h4><p>这是一个覆盖（override）了 <code>QOpenGLWidget</code> 中的 <code>paintEvent</code> 函数。 <code>paintEvent</code> 在 Qt 中是一个虚函数，当窗口部件需要重绘时（例如窗口大小改变，或者通过 <code>update()</code> 函数请求重绘时），Qt 会自动调用这个函数。</p><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;videoWidget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化操作在QOpenGLWidget(p)进行</span></span><br><span class="line">videoWidget::<span class="built_in">videoWidget</span>(QWidget* p) :<span class="built_in">QOpenGLWidget</span>(p)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">videoWidget::paintEvent</span><span class="params">(QPaintEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//用于执行绘图操作</span></span><br><span class="line">	QPainter p;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//begin()函数开始在当前小部件（this）上进行绘图操作</span></span><br><span class="line">	p.<span class="built_in">begin</span>(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在小部件的原点（QPoint(0, 0)）处绘制图像img</span></span><br><span class="line">    <span class="comment">//img包含了之前设置的图像数据</span></span><br><span class="line">	p.<span class="built_in">drawImage</span>(<span class="built_in">QPoint</span>(<span class="number">0</span>, <span class="number">0</span>), img);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//结束绘图操作，释放相关资源</span></span><br><span class="line">	p.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">videoWidget::~<span class="built_in">videoWidget</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">videoWidget::setImage</span><span class="params">(cv::Mat mat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (img.<span class="built_in">isNull</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//图像处理都要用uchar,否则会造成数据丢失</span></span><br><span class="line">		<span class="comment">//宽高像素</span></span><br><span class="line">		<span class="comment">//创建了一个大小为width() * height() * 3的缓冲区buf，用来存储图像数据</span></span><br><span class="line">        <span class="comment">//width()和height()是视频小部件的宽度和高度</span></span><br><span class="line">        <span class="comment">//乘以3是因为每个像素在Format_RGB888格式下占用3个字节（分别表示红、绿、蓝三个颜色通道）</span></span><br><span class="line">		uchar* buf = <span class="keyword">new</span> uchar[<span class="built_in">width</span>() * <span class="built_in">height</span>() * <span class="number">3</span>];</span><br><span class="line">        <span class="comment">//创建一个新的QImage对象，并将buf作为其内部数据存储</span></span><br><span class="line">		img = <span class="built_in">QImage</span>(buf, <span class="built_in">width</span>(), <span class="built_in">height</span>(), QImage::Format_RGB888);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//将OpenCV图像mat的数据复制到QImage的缓冲区中。</span></span><br><span class="line">    <span class="comment">//img.bits()返回QImage数据的指针，mat.data是cv::Mat图像数据的指针。</span></span><br><span class="line">    <span class="comment">//mat.cols * mat.rows * mat.elemSize()计算了需要复制的数据大小</span></span><br><span class="line">	<span class="built_in">memcpy</span>(img.<span class="built_in">bits</span>(), mat.data, mat.cols * mat.rows * mat.<span class="built_in">elemSize</span>());</span><br><span class="line"></span><br><span class="line">	<span class="comment">//刷新会调用到paintevent</span></span><br><span class="line">    <span class="comment">//设置了新的图像数据后，小部件会立即刷新显示</span></span><br><span class="line">	<span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2025-03-02 18:57:03" itemprop="dateModified" datetime="2025-03-02T18:57:03+08:00">2025-03-02</time> </span><span id="2024/08/07/openCV图片和视频处理/" class="item leancloud_visitors" data-flag-title="openCV图片和视频处理" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/mywechatpay.jpg" alt="Aura-HY WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/myalipay.jpg" alt="Aura-HY Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Aura-HY PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Aura-HY <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>Post link: </strong><a href="http://www.ssshyoo.top/2024/08/07/openCV%E5%9B%BE%E7%89%87%E5%92%8C%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" title="openCV图片和视频处理">http://www.ssshyoo.top/2024/08/07/openCV图片和视频处理/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"></div><div class="item right"><a href="/2024/12/21/knowledgeGraph/zeroToOne/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;Aura-HY&#x2F;blogImage@main&#x2F;img&#x2F;wallpaper上令人惊艳的壁纸_2_柚子的壁纸_来自小红书网页版.jpg" title="从零开始的知识图谱"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> 知识图谱</span><h3>从零开始的知识图谱</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#opencvqt"><span class="toc-number">1.</span> <span class="toc-text">OpenCV+QT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">文件项目配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91"><span class="toc-number">1.2.</span> <span class="toc-text">开发遇到的坑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ui-%E6%96%87%E4%BB%B6%E6%89%93%E4%B8%8D%E5%BC%80"><span class="toc-number">1.2.1.</span> <span class="toc-text">ui 文件打不开</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E6%96%87%E4%BB%B6%E6%89%93%E4%B8%8D%E5%BC%80"><span class="toc-number">1.2.2.</span> <span class="toc-text">源文件打不开</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mat"><span class="toc-number">1.3.</span> <span class="toc-text">mat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#roi%E6%84%9F%E5%85%B4%E8%B6%A3%E5%8C%BA%E5%9F%9F%E8%A3%81%E5%89%AA%E5%9B%BE%E5%83%8F"><span class="toc-number">1.4.</span> <span class="toc-text">ROI 感兴趣区域裁剪图像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cvrect-rect100100300300"><span class="toc-number">1.4.1.</span> <span class="toc-text">cv::Rect rect(100,100,300,300)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E6%A0%BC%E5%BC%8F%E5%92%8C%E7%81%B0%E5%BA%A6%E5%9B%BE"><span class="toc-number">1.5.</span> <span class="toc-text">像素格式和灰度图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rgb"><span class="toc-number">1.5.1.</span> <span class="toc-text">RGB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yuv"><span class="toc-number">1.5.2.</span> <span class="toc-text">YUV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rgay"><span class="toc-number">1.5.3.</span> <span class="toc-text">RGAY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cvtcolorsrcimgcolor_bgr2gray"><span class="toc-number">1.5.4.</span> <span class="toc-text">cvtColor(src,img,COLOR_BGR2GRAY)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E8%BD%AC%E6%8D%A2%E7%81%B0%E5%BA%A6%E5%9B%BE"><span class="toc-number">1.5.5.</span> <span class="toc-text">手动实现转换灰度图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%80%BC%E5%8C%96%E5%92%8C%E9%98%88%E5%80%BC"><span class="toc-number">1.6.</span> <span class="toc-text">二值化和阈值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%80%BC%E5%8C%96"><span class="toc-number">1.6.1.</span> <span class="toc-text">二值化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-thresh_binary%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%98%88%E5%80%BC%E5%8C%96"><span class="toc-number">1.6.2.</span> <span class="toc-text">1、 THRESH_BINARY 二进制阈值化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-thresh_binary_inv%E5%8F%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%98%88%E5%80%BC%E5%8C%96"><span class="toc-number">1.6.3.</span> <span class="toc-text">2、 THRESH_BINARY_INV 反二进制阈值化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%9B%BE%E7%89%87%E7%9A%84%E5%AF%B9%E6%AF%94%E5%BA%A6%E5%92%8C%E4%BA%AE%E5%BA%A6"><span class="toc-number">1.7.</span> <span class="toc-text">改变图片的对比度和亮度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gij-afij-b"><span class="toc-number">1.7.1.</span> <span class="toc-text">g(i,j) &#x3D; a*f(i,j) + b</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#saturate_castuchar%E9%98%B2%E6%AD%A2%E6%BA%A2%E5%87%BA"><span class="toc-number">1.7.2.</span> <span class="toc-text">saturate_cast&lt;uchar&gt; 防止溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opencv%E5%87%BD%E6%95%B0convertto"><span class="toc-number">1.7.3.</span> <span class="toc-text">opencv 函数 convertTo()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%B0%BA%E5%AF%B8%E8%B0%83%E6%95%B4"><span class="toc-number">1.8.</span> <span class="toc-text">图像尺寸调整</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inter_nearest%E9%82%BB%E8%BF%91%E7%AE%97%E6%B3%95"><span class="toc-number">1.8.1.</span> <span class="toc-text">INTER_NEAREST 邻近算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">自定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#opencv%E7%9A%84-resize"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">OpenCV 的 resize()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cv_inter_linear-%E5%8F%8C%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC%E7%BC%BA%E7%9C%81%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.2.</span> <span class="toc-text">CV_INTER_LINEAR 双线性插值（缺省使用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%A4%E6%B3%A2"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">滤波</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E7%BA%BF%E6%80%A7%E5%86%85%E6%8F%92%E5%80%BC"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">双线性内插值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E9%87%91%E5%AD%97%E5%A1%94"><span class="toc-number">1.9.</span> <span class="toc-text">图像金字塔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E6%96%AF%E9%87%91%E5%AD%97%E5%A1%94%E5%90%91%E4%B8%8B%E9%87%87%E6%A0%B7%E7%BC%A9%E5%B0%8F"><span class="toc-number">1.9.1.</span> <span class="toc-text">高斯金字塔（向下采样缩小）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E6%96%AF%E5%86%85%E6%A0%B8"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">高斯内核</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E9%87%91%E5%AD%97%E5%A1%94"><span class="toc-number">1.9.2.</span> <span class="toc-text">拉普拉斯金字塔</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E5%B9%85%E5%9B%BE%E5%83%8F%E6%B7%B7%E5%90%88blending"><span class="toc-number">1.10.</span> <span class="toc-text">两幅图像混合（blending）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F"><span class="toc-number">1.10.1.</span> <span class="toc-text">公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opencv-addweighted"><span class="toc-number">1.10.2.</span> <span class="toc-text">OpenCV- addWeighted()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E6%97%8B%E8%BD%AC%E5%92%8C%E9%95%9C%E5%83%8F"><span class="toc-number">1.11.</span> <span class="toc-text">图像旋转和镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC"><span class="toc-number">1.11.1.</span> <span class="toc-text">旋转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F"><span class="toc-number">1.11.2.</span> <span class="toc-text">镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87roi%E5%9B%BE%E5%83%8F%E5%90%88%E5%B9%B6"><span class="toc-number">1.12.</span> <span class="toc-text">通过 ROI 图像合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ffmpeg%E5%B7%A5%E5%85%B7%E6%8A%BD%E5%8F%96%E5%89%AA%E5%88%87%E9%9F%B3%E9%A2%91%E5%90%88%E5%B9%B6%E8%A7%86%E9%A2%91"><span class="toc-number">1.13.</span> <span class="toc-text">ffmpeg 工具抽取剪切音频合并视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E9%9F%B3%E9%A2%91"><span class="toc-number">1.13.1.</span> <span class="toc-text">抽取音频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E5%88%87%E9%9F%B3%E9%A2%91"><span class="toc-number">1.13.2.</span> <span class="toc-text">剪切音频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%88%E5%B9%B6"><span class="toc-number">1.13.3.</span> <span class="toc-text">音视频合并</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opencv-videocapture%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91"><span class="toc-number">1.14.</span> <span class="toc-text">OpenCV VideoCapture 读取视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#videocapture%E7%B1%BB"><span class="toc-number">1.14.1.</span> <span class="toc-text">VideoCapture 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E6%96%B9%E5%BC%8F"><span class="toc-number">1.14.2.</span> <span class="toc-text">打开摄像头方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bool-openint-index"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">bool open(int index)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#openint-cameranumint-apipreference"><span class="toc-number">1.14.2.1.1.</span> <span class="toc-text">open(int cameraNum.int apiPreference)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#videocapture-capindex"><span class="toc-number">1.14.2.2.</span> <span class="toc-text">VideoCapture cap(index)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E8%A7%86%E9%A2%91%E6%B5%81%E6%96%87%E4%BB%B6"><span class="toc-number">1.14.3.</span> <span class="toc-text">打开视频流文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bool-openconst-string-filename"><span class="toc-number">1.14.3.1.</span> <span class="toc-text">bool open(const String &amp;filename)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#videocapture-capconst-string-file"><span class="toc-number">1.14.3.2.</span> <span class="toc-text">VideoCapture cap(const String&amp; file)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bool-openconst-string-filenameint-apipreference"><span class="toc-number">1.14.3.3.</span> <span class="toc-text">bool open(const String &amp;filename,int apiPreference)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E5%92%8C%E7%A9%BA%E9%97%B4%E9%87%8A%E6%94%BE"><span class="toc-number">1.14.4.</span> <span class="toc-text">关闭和空间释放</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#~videocapture"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">~VideoCapture()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#release"><span class="toc-number">1.14.4.2.</span> <span class="toc-text">release()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%80%E5%B8%A7%E8%A7%86%E9%A2%91"><span class="toc-number">1.15.</span> <span class="toc-text">读取一帧视频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#readoutputarray-image"><span class="toc-number">1.15.1.</span> <span class="toc-text">read(OutputArray image)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bool-grab"><span class="toc-number">1.15.2.</span> <span class="toc-text">bool grab()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#virtual-bool-retrieveoutputarray-imageint-flag-0"><span class="toc-number">1.15.3.</span> <span class="toc-text">virtual bool retrieve(OutputArray image,int flag &#x3D; 0 )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vcmat"><span class="toc-number">1.15.4.</span> <span class="toc-text">vc&gt;&gt;mat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91-%E7%9B%B8%E6%9C%BA%E5%B1%9E%E6%80%A7"><span class="toc-number">1.16.</span> <span class="toc-text">获取视频、相机属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_fps-%E5%B8%A7%E7%8E%87"><span class="toc-number">1.16.1.</span> <span class="toc-text">CAP_PROP_FPS 帧率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_frame_count%E6%80%BB%E5%B8%A7%E6%95%B0"><span class="toc-number">1.16.2.</span> <span class="toc-text">CAP_PROP_FRAME_COUNT 总帧数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_pos_frames%E6%92%AD%E6%94%BE%E5%B8%A7%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.16.3.</span> <span class="toc-text">CAP_PROP_POS_FRAMES 播放帧的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_frame_width-height"><span class="toc-number">1.16.4.</span> <span class="toc-text">CAP_PROP_FRAME_WIDTH HEIGHT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E7%9A%84%E8%BF%9B%E5%BA%A6"><span class="toc-number">1.17.</span> <span class="toc-text">设置视频播放的进度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_pos_msec%E6%AF%AB%E7%A7%92%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.17.1.</span> <span class="toc-text">CAP_PROP_POS_MSEC 毫秒位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cap_prop_pos_frames%E5%B8%A7%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.17.2.</span> <span class="toc-text">CAP_PROP_POS_FRAMES 帧位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#videowriter"><span class="toc-number">1.18.</span> <span class="toc-text">VideoWriter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#void-writeconst-mat"><span class="toc-number">1.18.1.</span> <span class="toc-text">void write(const Mat&amp;)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cvvideowriter_ffmpegwriteframe"><span class="toc-number">1.18.2.</span> <span class="toc-text">CvVideoWriter_FFMPEG::writeFrame</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E5%88%B6%E6%91%84%E5%83%8F%E5%A4%B4%E8%A7%86%E9%A2%91%E5%B9%B6%E5%AD%98%E5%82%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.19.</span> <span class="toc-text">录制摄像头视频并存储代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">1.20.</span> <span class="toc-text">视频编辑器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bug%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.20.1.</span> <span class="toc-text">bug 修复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">1.20.2.</span> <span class="toc-text">流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%9C%9F"><span class="toc-number">1.20.2.1.</span> <span class="toc-text">前期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E6%98%BE%E7%A4%BA"><span class="toc-number">1.20.2.2.</span> <span class="toc-text">视频显示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="toc-number">1.20.2.3.</span> <span class="toc-text">视频进度条</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%BF%9B%E5%BA%A6%E6%9D%A1%E9%9A%8F%E8%A7%86%E9%A2%91%E5%8F%98%E5%8C%96"><span class="toc-number">1.20.2.3.1.</span> <span class="toc-text">设置进度条随视频变化：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%96%E5%8A%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1%E5%8F%98%E5%8C%96%E8%A7%86%E9%A2%91"><span class="toc-number">1.20.2.3.2.</span> <span class="toc-text">拖动进度条变化视频：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E4%BA%AE%E5%BA%A6%E5%92%8C%E5%AF%B9%E6%AF%94%E5%BA%A6%E8%B0%83%E6%95%B4"><span class="toc-number">1.20.2.4.</span> <span class="toc-text">视频亮度和对比度调整</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0videofilter%E7%B1%BB"><span class="toc-number">1.20.2.4.1.</span> <span class="toc-text">添加 videoFilter 类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E7%95%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.20.2.4.2.</span> <span class="toc-text">接收界面设置的参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%A4%84%E7%90%86%E5%90%8E%E7%9A%84%E8%A7%86%E9%A2%91"><span class="toc-number">1.20.2.4.3.</span> <span class="toc-text">输出处理后的视频</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E6%AF%8F%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD"><span class="toc-number">1.20.2.5.</span> <span class="toc-text">后续每添加一个功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#videothreadh"><span class="toc-number">1.20.3.</span> <span class="toc-text">videoThread.h</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#videothreadhpp"><span class="toc-number">1.20.4.</span> <span class="toc-text">videoThread.hpp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mutex-%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number">1.20.4.1.</span> <span class="toc-text">mutex 互斥锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#videowidgethpp"><span class="toc-number">1.20.5.</span> <span class="toc-text">videoWidget.hpp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#void-videowidgetpainteventqpaintevent-e"><span class="toc-number">1.20.5.1.</span> <span class="toc-text">void videoWidget::paintEvent(QPaintEvent* e)</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Aura-HY" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Aura-HY</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">4</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span> <span class="name">categories</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0F1cmEtSFk=" title="https:&#x2F;&#x2F;github.com&#x2F;Aura-HY"><i class="ic i-github"></i></span> <a href="/2743070095@qq.com" title="2743070095@qq.com" class="item email"><i class="ic i-envelope"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/knowledgeGraph/" title="In 知识图谱">知识图谱</a></div><span><a href="/2024/12/21/knowledgeGraph/zeroToOne/" title="从零开始的知识图谱">从零开始的知识图谱</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/tool/" title="In 工具使用">工具使用</a> <i class="ic i-angle-right"></i> <a href="/categories/tool/git-know/" title="In git知识">git知识</a></div><span><a href="/2025/02/28/tool/git-know/GitUse/" title="Git的配置与VS图形化的简单使用">Git的配置与VS图形化的简单使用</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/08/07/openCV%E5%9B%BE%E7%89%87%E5%92%8C%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" title="openCV图片和视频处理">openCV图片和视频处理</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/03/02/Shoka%E4%B8%BB%E9%A2%98%E5%8D%9A%E5%AE%A2%E8%A1%A5%E5%85%85/" title="Shoka主题博客补充">Shoka主题博客补充</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Aura-HY @ Aura-HY's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">20k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">18 mins.</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/08/07/openCV图片和视频处理/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->